# 统一知识库系统项目结构规划

## 项目根目录结构

```
src/
├── knowledge_base/           # 主要代码目录
│   ├── __init__.py          # 包初始化，导出主要类
│   ├── core/                # 核心模块
│   ├── storage/             # 存储模块
│   ├── processing/          # 处理模块
│   ├── retrieval/           # 检索模块
│   ├── generation/          # 生成模块
│   ├── agents/              # 智能体模块
│   └── api/                 # API接口模块
├── __init__.py              # 包初始化
└── main.py                  # 主入口点

tests/                       # 测试目录
├── unit/                    # 单元测试
├── integration/             # 集成测试
├── e2e/                     # 端到端测试
├── performance/             # 性能测试
└── fixtures/                # 测试数据

docs/                        # 文档目录
├── api/                     # API文档
├── architecture/            # 架构文档
├── guides/                  # 使用指南
└── examples/                # 示例代码

scripts/                     # 脚本目录
├── setup/                   # 安装脚本
├── deploy/                  # 部署脚本
└── tools/                   # 工具脚本

.github/                     # GitHub配置
└── workflows/               # CI/CD工作流

docker/                      # Docker配置
├── Dockerfile               # 主Dockerfile
└── docker-compose.yml       # Docker Compose配置
```

## 详细模块结构

### 1. 核心模块 (src/knowledge_base/core/)

```
core/
├── __init__.py              # 导出核心类和函数
├── config.py                # 配置管理
├── types.py                 # 类型定义
├── exceptions.py            # 异常定义
├── knowledge_base.py        # 主接口类
├── factory.py               # 工厂类
├── registry.py              # 注册表
├── utils.py                 # 工具函数
└── logging.py               # 日志配置
```

### 2. 存储模块 (src/knowledge_base/storage/)

```
storage/
├── __init__.py              # 导出存储类和函数
├── base.py                  # 存储基类
├── vector_store.py          # 向量存储工厂
├── utils.py                 # 存储工具函数
└── providers/               # 存储提供商
    ├── __init__.py          # 提供商注册
    ├── memory.py            # 内存存储
    ├── notion.py            # Notion存储
    ├── oss.py               # OSS存储
    ├── gdrive.py            # Google Drive存储
    ├── chroma.py            # Chroma向量数据库
    └── hybrid.py            # 混合存储
```

### 3. 处理模块 (src/knowledge_base/processing/)

```
processing/
├── __init__.py              # 导出处理类和函数
├── processor.py             # 文档处理器
├── chunker.py               # 文本分块
├── embedder.py              # 向量化
├── utils.py                 # 处理工具函数
├── strategies/              # 分块策略
│   ├── __init__.py          # 策略注册
│   ├── recursive.py         # 递归分块
│   ├── sentence.py          # 句子分块
│   ├── paragraph.py         # 段落分块
│   └── fixed.py             # 固定长度分块
└── providers/               # 向量化提供商
    ├── __init__.py          # 提供商注册
    ├── sentence_transformers.py  # Sentence Transformers
    ├── openai.py            # OpenAI Embeddings
    ├── deepseek.py          # DeepSeek Embeddings
    ├── siliconflow.py       # SiliconFlow Embeddings
    └── simple.py            # 简单向量化
```

### 4. 检索模块 (src/knowledge_base/retrieval/)

```
retrieval/
├── __init__.py              # 导出检索类和函数
├── retriever.py             # 检索器
├── reranker.py              # 重排序
├── cache.py                 # 检索缓存
├── utils.py                 # 检索工具函数
└── strategies/              # 检索策略
    ├── __init__.py          # 策略注册
    ├── semantic.py          # 语义检索
    ├── keyword.py           # 关键词检索
    └── hybrid.py            # 混合检索
```

### 5. 生成模块 (src/knowledge_base/generation/)

```
generation/
├── __init__.py              # 导出生成类和函数
├── generator.py             # 生成器
├── prompts.py               # 提示词模板
├── utils.py                 # 生成工具函数
└── providers/               # 生成提供商
    ├── __init__.py          # 提供商注册
    ├── openai.py            # OpenAI生成
    ├── deepseek.py          # DeepSeek生成
    ├── siliconflow.py       # SiliconFlow生成
    ├── ollama.py            # Ollama生成
    └── simple.py            # 简单生成
```

### 6. 智能体模块 (src/knowledge_base/agents/)

```
agents/
├── __init__.py              # 导出智能体类和函数
├── base.py                  # 智能体基类
├── orchestrator.py          # 协调智能体
├── collection.py            # 数据收集智能体
├── processing.py            # 知识处理智能体
├── storage.py               # 知识存储智能体
├── retrieval.py             # 知识检索智能体
├── maintenance.py           # 知识维护智能体
├── rag.py                   # RAG智能体
├── registry.py              # 智能体注册表
├── message.py               # 智能体消息
└── utils.py                 # 智能体工具函数
```

### 7. API模块 (src/knowledge_base/api/)

```
api/
├── __init__.py              # 导出API类和函数
├── server.py                # FastAPI服务器
├── models.py                # API模型
├── utils.py                 # API工具函数
├── routes/                  # API路由
│   ├── __init__.py          # 路由注册
│   ├── knowledge.py         # 知识管理接口
│   ├── query.py             # 查询接口
│   └── admin.py             # 管理接口
├── middleware/              # API中间件
│   ├── __init__.py          # 中间件注册
│   ├── auth.py              # 认证中间件
│   └── logging.py           # 日志中间件
└── websocket/               # WebSocket接口
    ├── __init__.py          # WebSocket注册
    ├── chat.py              # 聊天接口
    └── events.py            # 事件接口
```

## 测试目录结构

```
tests/
├── __init__.py              # 测试包初始化
├── conftest.py              # 测试配置
├── unit/                    # 单元测试
│   ├── core/                # 核心模块测试
│   ├── storage/             # 存储模块测试
│   ├── processing/          # 处理模块测试
│   ├── retrieval/           # 检索模块测试
│   ├── generation/          # 生成模块测试
│   └── agents/              # 智能体模块测试
├── integration/             # 集成测试
│   ├── test_rag_pipeline.py # RAG流水线测试
│   ├── test_api_endpoints.py # API端点测试
│   └── test_agent_coordination.py # 智能体协作测试
├── e2e/                     # 端到端测试
│   ├── test_complete_workflow.py # 完整工作流测试
│   └── test_user_scenarios.py # 用户场景测试
├── performance/             # 性能测试
│   ├── test_load.py         # 负载测试
│   └── test_stress.py       # 压力测试
└── fixtures/                # 测试数据
    ├── documents/           # 测试文档
    └── queries/             # 测试查询
```

## 文档目录结构

```
docs/
├── index.md                 # 文档首页
├── api/                     # API文档
│   ├── index.md             # API概述
│   ├── knowledge.md         # 知识管理API
│   ├── query.md             # 查询API
│   └── admin.md             # 管理API
├── architecture/            # 架构文档
│   ├── index.md             # 架构概述
│   ├── core.md              # 核心架构
│   ├── storage.md           # 存储架构
│   └── agents.md            # 智能体架构
├── guides/                  # 使用指南
│   ├── index.md             # 指南概述
│   ├── quickstart.md        # 快速开始
│   ├── configuration.md     # 配置指南
│   └── deployment.md        # 部署指南
└── examples/                # 示例代码
    ├── basic_usage.md       # 基本使用
    ├── custom_storage.md    # 自定义存储
    └── advanced_rag.md      # 高级RAG
```

## 配置文件结构

```
config/
├── default.yaml             # 默认配置
├── development.yaml         # 开发环境配置
├── testing.yaml             # 测试环境配置
└── production.yaml          # 生产环境配置
```

## 部署文件结构

```
docker/
├── Dockerfile               # 主Dockerfile
├── docker-compose.yml       # Docker Compose配置
├── .dockerignore            # Docker忽略文件
└── entrypoint.sh            # 容器入口脚本

kubernetes/
├── deployment.yaml          # Kubernetes部署配置
├── service.yaml             # Kubernetes服务配置
└── configmap.yaml           # Kubernetes配置映射
```

## CI/CD配置

```
.github/workflows/
├── test.yml                 # 测试工作流
├── build.yml                # 构建工作流
└── deploy.yml               # 部署工作流
```

## 项目根目录文件

```
.gitignore                   # Git忽略文件
.editorconfig                # 编辑器配置
pyproject.toml               # Python项目配置
README.md                    # 项目说明
LICENSE                      # 许可证
CHANGELOG.md                 # 变更日志
CONTRIBUTING.md              # 贡献指南
```

## 导入结构

主模块导入结构示例：

```python
# src/knowledge_base/__init__.py
from .core.knowledge_base import KnowledgeBase
from .core.config import Config
from .core.types import Document, DocumentType, QueryResult, AddResult

__all__ = [
    'KnowledgeBase',
    'Config',
    'Document',
    'DocumentType',
    'QueryResult',
    'AddResult',
]
```

子模块导入结构示例：

```python
# src/knowledge_base/storage/__init__.py
from .base import BaseVectorStore
from .vector_store import VectorStore, create_vector_store

__all__ = [
    'BaseVectorStore',
    'VectorStore',
    'create_vector_store',
]
```

## 使用示例

```python
# 基本使用示例
from src.knowledge_base import KnowledgeBase, Config, Document, DocumentType

# 创建配置
config = Config()
config.storage.provider = "memory"
config.embedding.provider = "sentence_transformers"
config.generation.provider = "openai"

# 初始化知识库
kb = KnowledgeBase(config)
await kb.initialize()

# 添加文档
doc = Document(
    id="doc1",
    content="Python是一种高级编程语言...",
    type=DocumentType.TEXT,
    metadata={"topic": "programming"}
)
result = await kb.add_document(doc)

# 查询知识库
answer = await kb.query("什么是Python？")
print(f"答案: {answer.answer}")
```

## 智能体使用示例

```python
# 智能体使用示例
from src.knowledge_base.agents import OrchestratorAgent

# 创建协调智能体
orchestrator = OrchestratorAgent(storage_provider="memory")

# 处理请求
result = await orchestrator.receive_request(
    source="user",
    request_type="add_knowledge",
    payload={
        "sources": [
            {"type": "text", "location": "Python是一种高级编程语言..."}
        ]
    }
)

# 查询知识
answer = await orchestrator.receive_request(
    source="user",
    request_type="query",
    payload={"query": "什么是Python？"}
)
```

## API使用示例

```python
# API服务器启动示例
from src.knowledge_base.api.server import create_app

app = create_app()

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)
```

## 注意事项

1. **模块依赖**: 确保模块间依赖清晰，避免循环导入
2. **接口一致性**: 保持公共接口的一致性和向后兼容
3. **配置隔离**: 各模块配置应当隔离，通过统一配置系统管理
4. **错误处理**: 统一的异常处理机制，避免异常泄漏
5. **资源管理**: 确保所有资源都能正确释放，支持上下文管理器
6. **测试覆盖**: 每个模块都应有对应的测试用例
7. **文档完整**: 每个模块、类和函数都应有完整的文档字符串