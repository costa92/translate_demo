# 教程：如何为集中存储设置 Google Drive 服务账户和共享云端硬盘

本文档将一步步指导您如何创建一个**服务账户 (Service Account)** 并将其与一个**共享云端硬盘 (Shared Drive)** 结合使用。这是实现**集中式、自动化、应用级存储**的 Google 推荐方法，可以完美解决“服务账户没有存储配额”的问题。

### 第一步：创建服务账户 (与之前相同)

1.  **打开服务账户页面**: 在您的浏览器中访问 Google Cloud Console，并确保您已选择正确的项目。然后直接进入服务账户页面：
    [https://console.cloud.google.com/iam-admin/serviceaccounts](https://console.cloud.google.com/iam-admin/serviceaccounts)

2.  **创建新服务账户**: 点击页面顶部的 **“+ 创建服务账号”**。

3.  **填写账户详情**: 命名您的服务账户（例如 `knowledge-base-storage-bot`）并点击 **“创建并继续”**。

4.  **跳过权限授予**: 点击 **“继续”** 和 **“完成”** 跳过后续步骤。

### 第二步：生成并下载 JSON 密钥文件 (与之前相同)

1.  **进入密钥管理**: 在服务账户列表中，找到您的账户，点击最右侧的“三个点”菜单 (⋮)，选择 **“管理密钥”**。
2.  **创建新密钥**: 点击 **“添加密钥”** > **“创建新密钥”**，选择 **JSON** 类型并创建。

浏览器将自动下载一个 JSON 文件。请妥善保管。

### 第三步：创建共享云端硬盘并添加服务账户为成员

这是解决存储配额问题的核心步骤。您将创建一个独立的存储空间，然后将您的服务账户添加为该空间的管理员。

1.  **打开 Google Drive**: 访问您的个人 Google Drive 网站：[https://drive.google.com](https://drive.google.com)。

2.  **创建共享云端硬盘**: 
    *   在左侧菜单中，点击 **“共享云端硬盘” (Shared drives)**。
    *   点击右上角的 **“新建”** 按钮。
    *   为您的共享云端硬盘命名（例如 `KnowledgeBaseStorage`），然后点击 **“创建”**。

3.  **管理成员**: 创建成功后，点击页面顶部的共享云端硬盘名称（例如 `KnowledgeBaseStorage`），然后选择 **“管理成员”**。

4.  **添加服务账户**: 
    *   **获取服务账户的电子邮件地址**: 返回 Google Cloud Console 的服务账户列表页面，复制您创建的服务账户的电子邮件地址（它看起来像 `...@...gserviceaccount.com`）。
    *   在 Google Drive 的“管理成员”窗口中，将这个**电子邮件地址粘贴**到“添加用户和群组”的输入框中。

5.  **授予正确权限**:
    *   在下拉菜单中，将服务账户的角色设置为 **“内容管理员” (Content manager)**。这授予了它添加、修改和删除文件的全部权限。
    *   **取消勾选“通知相关人员”**。
    *   点击 **“共享”**。

### 第四步：在共享云端硬盘中创建目标文件夹

为了简化代码逻辑，请在您刚刚创建的共享云端硬盘中**手动创建一个文件夹**。

1.  进入您的共享云端硬盘。
2.  创建一个新文件夹，并将其命名为您希望在配置中使用的名称（例如 `CentralizedKnowledgeBase`）。

### 第五步：配置您的应用

1.  **移动密钥文件**: 将您下载的 JSON 密钥文件移动到您的项目目录中。
2.  **更新配置**: 在您的代码中，确保 `provider_type` 为 `google_drive_service_account`，并且 `folder_name` 与您在共享云端硬盘中创建的文件夹名称完全匹配。

您现在已经成功配置了服务账户和共享云端硬盘！您的应用将能够将所有文件存储到这个集中、独立、拥有自己存储空间的共享云端硬盘中。

> **安全警告**: 服务账户的 JSON 密钥文件非常敏感。**绝对不要**将其提交到 Git。请确保它已被添加到 `.gitignore` 文件中。